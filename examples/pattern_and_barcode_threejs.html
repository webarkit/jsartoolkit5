<html>
<body>
<style>
canvas {
	transform: scale(-1, 1);
}
</style>

<script src="js/third_party/three.js/three.min.js"></script>

<script src="../build/artoolkit.debug.js"></script>
<script src="../js/artoolkit.api.js"></script>

<script src="../js/artoolkit.three.js"></script>

<script>

ARController.getUserMediaThreeScene({
	width: 320, height: 240,
	cameraParam: 'Data/camera_para.dat',

	onError: function(error) {
		console.log("Failed to start AR", error);
	},

	onSuccess: function(arScene, arController, arCamera) {
	
		arController.setPatternDetectionMode(artoolkit.AR_TEMPLATE_MATCHING_COLOR_AND_MATRIX);

		var renderer = new THREE.WebGLRenderer({antialias: true});
		renderer.setSize(arScene.video.videoWidth, arScene.video.videoHeight);

		document.body.appendChild(renderer.domElement);

		// Create a couple of lights for our AR scene.
		var light = new THREE.PointLight(0xffffff);
		light.position.set(40, 40, 40);
		arScene.scene.add(light);

		var light = new THREE.PointLight(0xff8800);
		light.position.set(-40, -20, -30);
		arScene.scene.add(light);

		var redCube = new THREE.Mesh( new THREE.BoxGeometry(1,1,1), new THREE.MeshLambertMaterial({ color: 0xff3333 }) );
		redCube.position.z = 0.5;

		// See /doc/patterns/Matrix code 3x3 (72dpi)/20.png
		var markerRoot20 = arController.createThreeBarcodeMarker(20);
		arScene.scene.add(markerRoot20);
		markerRoot20.add(redCube);

		var blueCube = new THREE.Mesh( new THREE.BoxGeometry(1,1,1), new THREE.MeshLambertMaterial({ color: 0x3333ff }) );
		blueCube.position.z = 0.5;

		// See /doc/patterns/Matrix code 3x3 (72dpi)/5.png
		var markerRoot5 = arController.createThreeBarcodeMarker(5);
		arScene.scene.add(markerRoot5);
		markerRoot5.add(blueCube);

		// Load the marker to use.
		arController.loadMarker('Data/patt.hiro', function(marker) {

			console.log('hiro is', marker);

			var greenCube = new THREE.Mesh( new THREE.BoxGeometry(1,1,1), new THREE.MeshLambertMaterial({ color: 0x33ff33 }) );
			greenCube.position.z = 0.5;

			// Create an object that tracks the marker transform.
			var markerRoot = arController.createThreeMarker(marker);
			arScene.scene.add(markerRoot);
			markerRoot.add(greenCube);

		});

		// Load the marker to use.
		arController.loadMarker('Data/patt.kanji', function(marker) {

			console.log('kanji is', marker);

			var greenCube = new THREE.Mesh( new THREE.BoxGeometry(1,1,1), new THREE.MeshLambertMaterial({ color: 0xffcc33 }) );
			greenCube.position.z = 0.5;

			// Create an object that tracks the marker transform.
			var markerRoot = arController.createThreeMarker(marker);
			arScene.scene.add(markerRoot);
			markerRoot.add(greenCube);

			var tick = function() {
				requestAnimationFrame(tick);
				arScene.process();
				arScene.renderOn(renderer);
			};
			tick();

		});

	}
});

</script>

</body>
</html>